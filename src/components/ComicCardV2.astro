---
import type { CollectionEntry } from 'astro:content';
import ComicImage from './ComicImage.astro';
import VoteButton from './VoteButton.astro';
import ShareActions from './ShareActions.astro';

interface Props {
	comic: CollectionEntry<'comics'>;
	eager?: boolean;
}

const { comic, eager = false } = Astro.props;
const formattedDate = comic.data.date.toLocaleDateString('fr-FR', {
	day: '2-digit',
	month: '2-digit',
	year: 'numeric',
});
---

<div>
	<!-- Header above the paper: title-link left, actions pill right -->
	<div class="flex items-center gap-3 pb-2 md:pb-3">
		<a
			href={`/${comic.id}`}
			class="no-underline min-w-0 truncate text-zinc-900 hover:text-zinc-500 transition-colors"
			data-umami-event="click-permalink"
			data-umami-event-comic={comic.id}
		>{comic.data.title}</a>
		<!-- Actions pill: close to title, grouped -->
		<div class="ml-auto flex items-center shrink-0 bg-zinc-100 rounded-full px-1 py-0.5">
			<VoteButton slug={comic.id} />
			<ShareActions slug={comic.id} title={comic.data.title} />
		</div>
	</div>

	<!-- Paper: images only -->
	<!-- px-6 / md:px-12 / border must match layoutTokens cardPad*Rem and cardBorderPx -->
	<article class="px-6 py-6 md:px-12 md:py-8 border border-zinc-300 shadow-lg">
		<div class="comic-grid grid grid-cols-1 md:grid-cols-2">
			{comic.data.pages.map((page, i) => (
				<ComicImage
					src={page}
					alt={`${comic.data.alt} — page ${i + 1}`}
					eager={eager}
				/>
			))}
		</div>
	</article>

	<!-- Minimal footer: slug + date only, very quiet -->
	<div class="flex items-center gap-x-3 pt-2 text-xs text-zinc-400">
		<span>{comic.id}</span>
		<span aria-hidden="true">·</span>
		<time datetime={comic.data.date.toISOString()}>{formattedDate}</time>
	</div>
</div>
