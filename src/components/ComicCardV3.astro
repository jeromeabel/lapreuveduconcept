---
import type { CollectionEntry } from 'astro:content';
import ComicImage from './ComicImage.astro';
import VoteButton from './VoteButton.astro';
import ShareActions from './ShareActions.astro';

interface Props {
	comic: CollectionEntry<'comics'>;
	eager?: boolean;
}

const { comic, eager = false } = Astro.props;
const formattedDate = comic.data.date.toLocaleDateString('fr-FR', {
	day: '2-digit',
	month: '2-digit',
	year: 'numeric',
});
---

<div class="relative">
	<!-- Paper: images + caption printed inside, like an art drawing label -->
	<!-- px-6 / md:px-12 / border must match layoutTokens cardPad*Rem and cardBorderPx -->
	<article class="p-6 md:px-12 md:pt-12 border border-zinc-300 shadow-lg">
		<div class="comic-grid grid grid-cols-1 md:grid-cols-2">
			{comic.data.pages.map((page, i) => (
				<ComicImage
					src={page}
					alt={`${comic.data.alt} — page ${i + 1}`}
					eager={eager}
				/>
			))}
		</div>

		<!-- Caption strip inside the paper — info lives on the sheet, like an artist signature -->
		<div class="flex items-baseline gap-x-3 pt-3 pb-4 md:pt-4 md:pb-6 text-xs text-zinc-400">
			<a
				href={`/${comic.id}`}
				class="no-underline text-zinc-600 shrink-0 hover:text-zinc-900 transition-colors"
				data-umami-event="click-permalink"
				data-umami-event-comic={comic.id}
			>{comic.id}</a>
			<span aria-hidden="true">·</span>
			<span class="min-w-0 truncate text-zinc-500">{comic.data.title}</span>
			<time datetime={comic.data.date.toISOString()} class="ml-auto shrink-0">{formattedDate}</time>
		</div>
	</article>

	<!-- Floating actions pill: detached, right-aligned below the paper -->
	<div class="flex justify-end absolute -bottom-5 right-5">
		<div class="flex items-center bg-zinc-100 rounded-full px-3 py-1">
			<VoteButton slug={comic.id} />
			<ShareActions slug={comic.id} title={comic.data.title} />
		</div>
	</div>
</div>
